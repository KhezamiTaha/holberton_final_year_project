<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circular Progress Bar with Inner Shadow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: #f0f3f8;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      /* ✅ Green (success >60%) */
      --grad-green-start: #47c34f;
      --grad-green-end: #00a651;

      /* ✅ Orange/Yellow (warning >30% && <=60%) */
      --grad-orange-start: #ffcc33;
      --grad-orange-end: #ff6600;

      /* ✅ Red (danger <=30%) */
      --grad-red-start: #ff5f6d;
      --grad-red-end: #d32f2f;
    }

    .progress-container {
      position: relative;
      width: 300px;
      height: 300px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .progress-bg {
      stroke: #d3dbec;
      fill: none;
      stroke-width: 30;
    }

    .progress-bg-shadow {
      stroke: #d3dbec;
      fill: none;
      stroke-width: 25;
    }


    .progress-bg-border {
      stroke: #dbdff0;
      fill: none;
      stroke-width: 5;

      /* filter: drop-shadow(0 0 20px rgba(0,0,0,0.7)); */
    }

    .progress-fill {
      stroke: url(#gradient);
      fill: none;
      stroke-width: 30;
      stroke-linecap: round;
      stroke-dasharray: 691.15;
      stroke-dashoffset: 691.15;
      filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
    }

    .progress-head {
      position: absolute;
      width: 30px;
      height: 30px;
      background: #8aec9e;

      border-radius: 50%;
      top: 50%;
      left: 50%;
      margin: -20px 0 0 -20px;
      transform-origin: center;
      box-shadow:
        0 0 20px rgba(255, 255, 255, 0.8),
        0 0 40px rgba(100, 181, 246, 0.5),
        inset 0 0 15px rgba(255, 255, 255, 0.5);
      z-index: 10;
    }

    .progress-head::before {
      content: '';
      position: absolute;
      width: 50px;
      height: 50px;
      background: radial-gradient(circle, rgba(184, 223, 255, 0.4), transparent);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.9;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.1);
        opacity: 0.7;
      }
    }

    .progress-text {
      position: absolute;
      font-size: 48px;
      font-weight: bold;
      background: linear-gradient(to bottom, #00ff88, #00a651);
      -webkit-background-clip: text;
      /* Chrome / Safari */
      -webkit-text-fill-color: transparent;
      background-clip: text;
      /* Modern browsers */
      color: transparent;
      /* fallback */
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      /* optional shadow */
    }
  </style>
</head>

<body>
  <div class="progress-container">
    <svg class="progress-ring" width="300" height="300">
      <defs>
        <!-- Gradient (already in your code) -->
        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop id="gradStart" offset="70%" stop-color="var(--grad-green-end)" />
          <stop id="gradEnd" offset="100%" stop-color="var(--grad-green-start)" />
        </linearGradient>

        <!-- Shadow filter -->
        <filter id="outer-shadow" x="-50%" y="-50%" width="200%" height="200%">
          <!-- Blur the shape -->
          <feGaussianBlur in="SourceAlpha" stdDeviation="20" result="blur" />

          <!-- Keep only the part OUTSIDE the original shape -->
          <feComposite in="blur" in2="SourceAlpha" operator="out" result="outer" />

          <!-- Apply color + opacity -->
          <feFlood flood-color="#000" flood-opacity="0.03" result="shadowColor" />
          <feComposite in="shadowColor" in2="outer" operator="in" result="shadow" />

          <!-- Merge with original graphic -->
          <feMerge>
            <feMergeNode in="shadow" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

      </defs>


      <!-- Background circle with inner shadow -->
      <circle class="progress-bg" cx="150" cy="150" r="110"></circle>
      <circle class="progress-bg-shadow" cx="150" cy="150" r="108" filter="url(#outer-shadow)"></circle>
      <circle class="progress-bg-border" cx="150" cy="150" r="127"></circle>

      <!-- Progress fill -->
      <circle class="progress-fill" cx="150" cy="150" r="110"></circle>
    </svg>

    <div class="progress-head"></div>
    <span class="progress-text">0%</span>
  </div>

  <script>
    const progressFill = document.querySelector(".progress-fill");
    const progressHead = document.querySelector(".progress-head");
    const progressText = document.querySelector(".progress-text");

    const radius = 110;
    const circumference = 2 * Math.PI * radius;
    const targetPercent = 40; // change this to test
    let currentPercent = 0;

    progressFill.style.strokeDasharray = circumference;

    // ✅ Set colors immediately based on targetPercent
    function setInitialColors(percent) {
      let start, end;
      if (percent > 60) {
        start = getComputedStyle(document.documentElement).getPropertyValue("--grad-green-start").trim();
        end = getComputedStyle(document.documentElement).getPropertyValue("--grad-green-end").trim();
      } else if (percent > 30) {
        start = getComputedStyle(document.documentElement).getPropertyValue("--grad-orange-start").trim();
        end = getComputedStyle(document.documentElement).getPropertyValue("--grad-orange-end").trim();
      } else {
        start = getComputedStyle(document.documentElement).getPropertyValue("--grad-red-start").trim();
        end = getComputedStyle(document.documentElement).getPropertyValue("--grad-red-end").trim();
      }

      // SVG gradient
      gradStart.setAttribute("stop-color", end);
      gradEnd.setAttribute("stop-color", start);

      // Text gradient
      progressText.style.background = `linear-gradient(to bottom, ${start}, ${end})`;
      progressText.style.webkitBackgroundClip = "text";
      progressText.style.webkitTextFillColor = "transparent";

      // Head color
      progressHead.style.background = start;
    }

    setInitialColors(targetPercent); // ✅ Apply before animation

    function animateProgress() {
      if (targetPercent == 0 || targetPercent == null) {
        // updateProgress(0)
        progressHead.style.display = "none";
      };
      const interval = setInterval(() => {
        if (currentPercent >= targetPercent) {
          clearInterval(interval);
        } else {
          currentPercent++;
          updateProgress(currentPercent);
        }
      }, 10);
    }

    function updateProgress(percent) {
      const offset = circumference - (percent / 100) * circumference;
      progressFill.style.strokeDashoffset = offset;
      progressText.textContent = percent + "%";

      const rotation = (percent / 100) * 360 - 90; // -90 because SVG is rotated -90deg
      progressHead.style.transform =
        `rotate(${rotation}deg) translateX(${radius}px) rotate(${-rotation}deg)`;

      // Margin adjustments (same as before)
      if (percent <= 5) {
        progressHead.style.margin = '-13px 0 0 -8px';
      } else if (percent <= 10) {
        progressHead.style.margin = '-8px 0 0 -8px';
      } else if (percent <= 15) {
        progressHead.style.margin = '-10px 0 0 -11px';
      } else if (percent <= 20) {
        progressHead.style.margin = '-10px 0 0 -14px';
      } else if (percent <= 25) {
        progressHead.style.margin = '-10px 0 0 -14px';
      } else if (percent <= 30) {
        progressHead.style.margin = '-10px 0 0 -16px';
      } else if (percent <= 35) {
        progressHead.style.margin = '-10px 0 0 -20px';
      } else if (percent <= 40) {
        progressHead.style.margin = '-8px 0 0 -26px';
      } else if (percent <= 45) {
        progressHead.style.margin = '-12px 0 0 -23px';
      } else if (percent <= 50) {
        progressHead.style.margin = '-15px 0 0 -20px';
      } else if (percent <= 55) {
        progressHead.style.margin = '-16px 0 0 -19px';
      } else if (percent <= 60) {
        progressHead.style.margin = '-18px 0 0 -18px';
      } else if (percent <= 65) {
        progressHead.style.margin = '-19px 0 0 -17px';
      } else if (percent <= 70) {
        progressHead.style.margin = '-20px 0 0 -16px';
      } else if (percent <= 75) {
        progressHead.style.margin = '-21px 0 0 -14px';
      } else if (percent <= 80) {
        progressHead.style.margin = '-23px 0 0 -12px';
      } else if (percent <= 85) {
        progressHead.style.margin = '-22px 0 0 -10px';
      } else if (percent <= 90) {
        progressHead.style.margin = '-21px 0 0 -7px';
      } else if (percent <= 95) {
        progressHead.style.margin = '-18px 0 0 -10px';
      } else {
        progressHead.style.margin = '-15px 0 0 -15px';
      }

    }

    animateProgress();
  </script>

</body>

</html>